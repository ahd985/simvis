function simdraw_context(){this.elements={},this.active_element=null,this.add_element=function(t,e){"rect"==t?this.elements[e]=new rect(t,e):"circle"==t?this.elements[e]=new circle(t,e):"path"==t&&(this.elements[e]=new path(t,e))},this.get_element=function(t){return this.elements[t]},this.activate_element=function(t){null!=this.active_element&&this.elements[this.active_element].deactivate(),this.elements[t].activate(),this.active_element=t},this.deactivate_element=function(){null!=this.active_element&&this.elements[this.active_element].deactivate(),this.active_element=null},this.delete_element=function(t){},this.initialize=function(){d3.select(".draw-container").on("click",context.deactivate_element())}}function element(t,e,n,i){this.type=t,this.id=e,this.pos=n,this.dims=i,this.element_id="element",this.style={fill:"grey",stroke:"black",cursor:"move"},this.outline_id="outline",this.outline_style={fill:"none",stroke:"black","stroke-width":"1px","stroke-dasharray":"5,5"},this.outline_type="rect",this.outline_attr={visibility:"hidden"},this.resizer_id="resizer",this.resizer_style={fill:"red"},this.resizer_type="circle",this.resizer_attr={r:2,cursor:"se-resize",visibility:"hidden"},this.set_element=function(){},this.set_resizer=function(){},this.set_outline=function(){},this.drag_move_func=function(t){},this.drag_resize_func=function(t){},this.menu=[{title:"Move Forward",action:function(t,e,n){next_sib=t.parentNode.nextSibling,null!=next_sib&&(null!=next_sib.nextSibling?t.parentNode.parentNode.insertBefore(t.parentNode,next_sib.nextSibling):t.parentNode.parentNode.appendChild(t.parentNode))}},{title:"Move Backwards",action:function(t,e,n){prev_sib=t.parentNode.previousSibling,null!=prev_sib&&t.parentNode.parentNode.insertBefore(t.parentNode,prev_sib)}}],this.initialize=function(){var t=d3.select("#draw-svg").append("g").datum(this.pos).attr("transform","translate("+[this.pos.x,this.pos.y]+") scale(1,1)").attr("id",this.id);t.append(this.type).attr("id",this.element_id).styles(this.style).call(this.drag_move).on("dblclick",function(){context.activate_element(this.parentNode.id)}).on("contextmenu",d3.contextMenu(this.menu)),t.append(this.outline_type).attr("id",this.outline_id).styles(this.outline_style).attrs(this.outline_attr),t.append(this.resizer_type).attrs(this.resizer_attr).attr("id",this.resizer_id).styles(this.resizer_style).call(this.drag_resize),this.render(this.dims)},this.render=function(t){var e=d3.select("#"+this.id);datum=e.datum();for(var n in t)datum[n]=t[n];e.datum(datum);var i=e.select("#"+this.outline_id),r=e.select("#"+this.element_id),a=e.select("#"+this.resizer_id);this.set_outline(i),this.set_element(r),this.set_resizer(a)},this.move=function(t){var e=d3.select("#"+this.id),n=e.datum();n.x+=t.x,n.y+=t.y,e.datum(n).attr("transform",function(t,e){return"translate("+[t.x,t.y]+")"})},this.activate=function(){var t=d3.select("#"+this.id);t.select("#"+this.outline_id).attr("visibility","visible"),t.selectAll("#"+this.resizer_id).each(function(){d3.select(this).attr("visibility","visible")})},this.deactivate=function(){var t=d3.select("#"+this.id);t.select("#"+this.outline_id).attr("visibility","hidden"),t.selectAll("#"+this.resizer_id).each(function(){d3.select(this).attr("visibility","hidden")})}}function rect(t,e){var n={x:0,y:0},i={width:50,height:50,margin:5},r=new element(t,e,n,i);return r.set_element=function(t){t.attr("x",function(t){return t.margin}).attr("y",function(t){return t.margin}).attr("height",function(t){return t.height}).attr("width",function(t){return t.width})},r.set_outline=function(t){t.attr("height",function(t){return t.height+2*t.margin}).attr("width",function(t){return t.width+2*t.margin})},r.set_resizer=function(t){t.attr("cx",function(t){return t.width+2*t.margin}).attr("cy",function(t){return t.height+2*t.margin})},r.drag_move=d3.drag().subject(function(){return{x:0,y:0}}).on("drag",function(){context.get_element(this.parentNode.id).move(d3.event)}),r.drag_resize=d3.drag().on("drag",function(t){context.get_element(this.parentNode.id).render({height:Math.max(1,d3.event.y-2*t.margin),width:Math.max(1,d3.event.x-2*t.margin)})}),r.initialize(),r}function circle(t,e){var n={x:0,y:0},i={r:25,margin:5},r=new element(t,e,n,i);return r.set_element=function(t){t.attr("r",function(t){return t.r}).attr("cx",function(t){return t.r+t.margin}).attr("cy",function(t){return t.r+t.margin})},r.set_resizer=function(t){t.attr("cx",function(t){return 2*(t.r+t.margin)}).attr("cy",function(t){return 2*(t.r+t.margin)})},r.set_outline=function(t){t.attr("height",function(t){return 2*t.r+2*t.margin}).attr("width",function(t){return 2*t.r+2*t.margin})},r.drag_move=d3.drag().subject(function(){return{x:0,y:0}}).on("drag",function(){context.get_element(this.parentNode.id).move(d3.event)}),r.drag_resize=d3.drag().on("drag",function(t){var e=d3.select("#"+this.parentNode.id).datum();context.get_element(this.parentNode.id).render({r:Math.max(Math.min(d3.event.x/2,d3.event.y/2)-e.margin,1),margin:e.margin})}),r.initialize(),r}function path(t,e){var n={x:0,y:0},i={path:[{x:0,y:0},{x:50,y:50},{x:0,y:50}],"x-range":[0,50],"y-range":[0,50],margin:5},r=new element(t,e,n,i);return r.line_function=d3.line().x(function(t){return t.x}).y(function(t){return t.y}).curve(d3.curveLinear),r.set_element=function(t){t.attr("d",function(t){return r.line_function(t.path)+"Z"})},r.set_outline=function(t){t.attr("height",function(t){return t["y-range"][1]-t["y-range"][0]+2*t.margin}).attr("width",function(t){return t["x-range"][1]-t["x-range"][0]+2*t.margin}).attr("x",function(t){return t["x-range"][0]-t.margin}).attr("y",function(t){return t["y-range"][0]-t.margin})},r.set_resizer=function(t){parent=d3.select(t.node().parentNode),parent.selectAll("#"+this.resizer_id).data(parent.datum().path).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).enter().append(this.resizer_type).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("id",this.resizer_id).attrs(this.resizer_attr).styles(this.resizer_style).call(this.drag_resize)},r.drag_move=d3.drag().subject(function(){return{x:0,y:0}}).on("drag",function(){context.get_element(this.parentNode.id).move(d3.event)}),r.drag_resize=d3.drag().on("drag",function(t,e){var n=d3.select("#"+this.parentNode.id).datum().path;n[e].x=d3.event.x,n[e].y=d3.event.y,context.get_element(this.parentNode.id).render({path:n,"x-range":[d3.min(n,function(t){return t.x}),d3.max(n,function(t){return t.x})],"y-range":[d3.min(n,function(t){return t.y}),d3.max(n,function(t){return t.y})]})}),r.initialize(),r}d3.contextMenu=function(t,e){return d3.selectAll(".d3-context-menu").data([1]).enter().append("div").attr("class","d3-context-menu"),d3.select("body").on("click.d3-context-menu",function(){d3.select(".d3-context-menu").style("display","none")}),function(n,i){var r=this;d3.selectAll(".d3-context-menu").html("");var a=d3.selectAll(".d3-context-menu").append("ul");a.selectAll("li").data(t).enter().append("li").html(function(t){return t.title}).on("click",function(t,e){t.action(r,n,i),d3.select(".d3-context-menu").style("display","none")}),e&&e(n,i),d3.select(".d3-context-menu").style("left",d3.event.pageX-2+"px").style("top",d3.event.pageY-2+"px").style("display","block"),d3.event.preventDefault()}},window.onresize=function(){var t=d3.select(".draw-visual").node().getBoundingClientRect();d3.select("#draw-svg").attr("viewbox","(0 0 "+t.width+" "+t.height+")")},context=null,$(document).ready(function(){context=new simdraw_context,context.initialize(),context.add_element("rect","rect-1"),context.add_element("circle","circle-1"),context.add_element("path","path-1")});